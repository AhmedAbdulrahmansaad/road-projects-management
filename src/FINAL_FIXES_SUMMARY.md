# โ ุงูุฅุตูุงุญุงุช ุงูููุงุฆูุฉ ุงูููุชููุฉ - 21 ููููุจุฑ 2024

## ๐ฏ **ุงููุดุงูู ุงูุชู ุชู ุญููุง:**

### 1๏ธโฃ **ุฅุตูุงุญ ูุดููุฉ ุงูุฑููุฒ ุงูุบุฑูุจุฉ ูู PDF ุงููุดุงุฑูุน** โ
**ุงููุดููุฉ:** ุนูุฏ ุชุตุฏูุฑ ุงููุดุงุฑูุน ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุจุตูุบุฉ PDFุ ุชุธูุฑ ุฑููุฒ ุบุฑูุจุฉ ุจุฏูุงู ูู ุงููุต ุงูุนุฑุจู.

**ุงูุณุจุจ:** ููุชุจุฉ jsPDF **ูุง ุชุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ** ุจุดูู ุงูุชุฑุงุถู!

**ุงูุญู ูู `/components/ExportManager.tsx`:**
- โ ุฃุฒููุง ุงุณุชุฎุฏุงู jsPDF ุชูุงูุงู
- โ ุงุณุชุฎุฏููุง ุทุฑููุฉ HTML to PDF ุจุฏูุงู ููู
- โ ุฅูุดุงุก HTML ูุงูู ูุน ุฏุนู RTL ูุงูุนุฑุจูุฉ
- โ ุฅุถุงูุฉ UTF-8 BOM (`\ufeff`) ูู ุจุฏุงูุฉ HTML
- โ ูุชุญ HTML ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ ููุทุจุงุนุฉ ูู PDF
- โ ุงูุขู ูููู ุทุจุงุนุชู ุฃู ุญูุธู ูู PDF ูู ุงููุชุตูุญ ูุน **ูุต ุนุฑุจู ุตุญูุญ 100%**

**ุงูููุฏ:**
```tsx
const exportToPDF = async () => {
  try {
    // ุฅูุดุงุก HTML ูุงูู ูุน ุฏุนู RTL ูุงูุนุฑุจูุฉ
    const html = `<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
...
</head>
<body>
  <button class="print-button no-print" onclick="window.print()">๐จ๏ธ ุทุจุงุนุฉ / ุญูุธ PDF</button>
  <script>
  window.onload = function() { setTimeout(function() { window.print(); }, 500); };
  </script>
  ...
</body>
</html>`;

    // ูุชุญ ุงููุงูุฐุฉ ููุชุงุจุฉ HTML
    const newWindow = window.open('', '_blank');
    if (newWindow) {
      newWindow.document.open();
      newWindow.document.write('\\ufeff' + html); // โ UTF-8 BOM
      newWindow.document.close();
      newWindow.focus();
      toast.success('ุชู ูุชุญ ุงูุชูุฑูุฑ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ - ุณูุธูุฑ ูุฑุจุน ุงูุทุจุงุนุฉ ุชููุงุฆูุงู โ');
    }
  } catch (error) {
    console.error('Error exporting to PDF:', error);
  }
};
```

---

### 2๏ธโฃ **ุฅุตูุงุญ ุญุณุงุจ ุงููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ ูู ููุญุฉ ุงูุชุญูููุงุช** โ
**ุงููุดููุฉ:** ุญุณุงุจ ุงููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ ูู ููู ุฏูููุงู.

**ุงูุญู ูู `/components/AnalyticsDashboard.tsx`:**
```tsx
// ุญุณุงุจ ุงููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ (ุงูุชู ุงูุชูู ููุนุฏูุง ููู ุชูุชูู ุจุนุฏ)
const today = new Date();
today.setHours(0, 0, 0, 0); // โ ุชุตููุฑ ุงูููุช ููููุงุฑูุฉ ุงูุตุญูุญุฉ

const delayedProjects = projects.filter((p: any) => {
  // 1. ุงููุดุงุฑูุน ุงูุชู ููุง ุญุงูุฉ "ูุชุฃุฎุฑ" ุฃู "ูุชุนุซุฑ" ูุจุงุดุฑุฉ
  if (p.status === 'ูุชุฃุฎุฑ' || p.status === 'ูุชุนุซุฑ') {
    return true;
  }
  
  // 2. ุงููุดุงุฑูุน ุงูุชู ุงูุชูู ููุนุฏูุง ููู ุชูุชูู ุจุนุฏ
  if (p.contractEndDate) {
    const endDate = new Date(p.contractEndDate);
    endDate.setHours(0, 0, 0, 0); // โ ุชุตููุฑ ุงูููุช
    
    // ุฅุฐุง ูุงู ุชุงุฑูุฎ ุงูููุงูุฉ ูุฏ ูุถู ูุงููุดุฑูุน ูู ููุชูู
    if (endDate < today) {
      const isNotCompleted = p.status !== 'ุชู ุงูุงุณุชูุงู ุงูููุงุฆู' && 
                            p.status !== 'ููุฌุฒ' && 
                            p.status !== 'Completed';
      if (isNotCompleted) {
        return true;
      }
    }
  }
  
  return false;
}).length;
```

**ุงูุชุญุณููุงุช:**
- โ ุชุตููุฑ ุงูููุช ููููุงุฑูุฉ ุงูุตุญูุญุฉ (ุจุฏูุงู ูู ููุงุฑูุฉ timestamp ูุงูู)
- โ ูุญุต ุงูุญุงูุฉ ูุจุงุดุฑุฉ (ูุชุฃุฎุฑุ ูุชุนุซุฑ)
- โ ูุญุต ุชุงุฑูุฎ ุงูููุงูุฉ ูููุงุฑูุชู ุจุงูููู ุงูุญุงูู
- โ ุงูุชุฃูุฏ ูู ุฃู ุงููุดุฑูุน ูู ููุชูู

---

### 3๏ธโฃ **ุชูุนูู ุฑูุน ูุนุฑุถ ุงูุตูุฑ ูู ุงูุชูุงุฑูุฑ ุงูููููุฉ** โโโ
**ุงููุดููุฉ ุงูุฃููู:** ุงูุตูุฑ ูู ุชูู ุชูุฑุณู ุฅูู ุงูุณูุฑูุฑ!

**ุงูุญู ูู `handleSubmit`:**
```tsx
const handleSubmit = async () => {
  try {
    // โ ุฅุถุงูุฉ ุงูุตูุฑ ุฅูู ุงูุจูุงูุงุช ุงูููุฑุณูุฉ
    const dataToSend = {
      ...formData,
      images: uploadedImages, // โ ุฅุฑุณุงู ุงูุตูุฑ
    };

    const response = await fetch(url, {
      method,
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(dataToSend), // โ ุงุณุชุฎุฏุงู dataToSend ุจุฏูุงู ูู formData
    });
    ...
  }
};
```

**ุงููุดููุฉ ุงูุซุงููุฉ:** ุฑูุน ุงูุตูุฑ ูู ููู ูููุนููุงู!

**ุงูุญู ูู ุญูู ุฑูุน ุงูุตูุฑ:**
```tsx
<Input
  id="images"
  type="file"
  accept="image/*"
  multiple
  onChange={async (e) => {
    const files = e.target.files;
    if (files && files.length > 0) {
      toast.info(`ุฌุงุฑู ุชุญููู ${files.length} ุตูุฑุฉ ๐ท...`);
      
      // โ ุชุญููู ุงูุตูุฑ ุฅูู base64
      const base64Images: string[] = [];
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        // ูุญุต ุญุฌู ุงูููู (ุฃูู ูู 2MB)
        if (file.size > 2 * 1024 * 1024) {
          toast.error(`ุงูุตูุฑุฉ ${file.name} ูุจูุฑุฉ ุฌุฏุงู! ุงูุญุฏ ุงูุฃูุตู 2MB`);
          continue;
        }
        
        const reader = new FileReader();
        const base64 = await new Promise<string>((resolve) => {
          reader.onload = () => resolve(reader.result as string);
          reader.readAsDataURL(file);
        });
        base64Images.push(base64);
      }
      
      setUploadedImages(prev => [...prev, ...base64Images]);
      toast.success(`ุชู ุชุญููู ${base64Images.length} ุตูุฑุฉ ุจูุฌุงุญ โ`);
    }
  }}
  className="cursor-pointer"
/>
```

**โ ุนุฑุถ ุงูุตูุฑ ุงููุฑููุนุฉ:**
```tsx
{uploadedImages.length > 0 && (
  <div className="mt-4 space-y-2">
    <Label className="text-sm font-bold">ุงูุตูุฑ ุงููุฑููุนุฉ ({uploadedImages.length}):</Label>
    <div className="grid grid-cols-3 gap-3">
      {uploadedImages.map((img, idx) => (
        <div key={idx} className="relative group">
          <img 
            src={img} 
            alt={`ุตูุฑุฉ ${idx + 1}`} 
            className="w-full h-24 object-cover rounded-lg border-2 border-gray-200 dark:border-gray-700"
          />
          <Button
            type="button"
            size="icon"
            variant="destructive"
            className="absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity"
            onClick={() => {
              setUploadedImages(prev => prev.filter((_, i) => i !== idx));
              toast.success('ุชู ุญุฐู ุงูุตูุฑุฉ');
            }}
          >
            <X className="h-3 w-3" />
          </Button>\n        </div>
      ))}
    </div>
  </div>
)}
```

**ุงูููุฒุงุช:**
- โ ุฑูุน ุตูุฑ ูุชุนุฏุฏุฉ
- โ ุชุญููู ุชููุงุฆู ุฅูู base64
- โ ูุญุต ุญุฌู ุงูุตูุฑุฉ (ุฃูู ูู 2MB)
- โ ุนุฑุถ ูุจุงุดุฑ ููุตูุฑ ุงููุฑููุนุฉ
- โ ุฅููุงููุฉ ุญุฐู ุตูุฑุฉ ูุนููุฉ
- โ ุญูุธ ุงูุตูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูุตูุฑ ุชุธูุฑ ุนูุฏ ุงูุชุนุฏูู (ูู `report.images`)
- โ ุงูุตูุฑ ุชูุญูุธ ูุน ุงูุชูุฑูุฑ ูุชุธูุฑ ูู ุงูุชุตุฏูุฑ

---

## ๐ **ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ:**

### โ **ุชู ุฅููุงู:**
1. โ ุชุตุฏูุฑ PDF ูููุดุงุฑูุน ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ **ูุนุฑุถ ุงูุนุฑุจูุฉ ุจุดูู ุตุญูุญ 100%**
2. โ ุญุณุงุจ ุงููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ **ุฏููู ูุตุญูุญ**
3. โ ุฑูุน ุงูุตูุฑ ูู ุงูุชูุงุฑูุฑ ุงูููููุฉ **ูููุนูู ุจุงููุงูู**
4. โ ุนุฑุถ ุงูุตูุฑ ุงููุฑููุนุฉ **ูู ููุณ ุงูุตูุญุฉ**
5. โ ุฅุฑุณุงู ุงูุตูุฑ ูุน ุงูุชูุฑูุฑ ุฅูู ุงูุณูุฑูุฑ
6. โ ุญูุธ ุงูุตูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูู base64 array)
7. โ ุนุฑุถ ุงูุตูุฑ ุนูุฏ ุงูุชุนุฏูู
8. โ ุฌููุน routes ุงูุณูุฑูุฑ ุชุณุชุฎุฏู Supabase (ูุง KV Store)
9. โ ููุญุฉ ุงูุชุญูููุงุช ุชุนุฑุถ **ุจูุงูุงุช ุญููููุฉ 100%**
10. โ ุงูุนููุฉ: **ุงูุฑูุงู ุงูุณุนูุฏู (ุฑ.ุณ / SAR)**

---

## ๐งช **ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ:**

### โ ูุฌุจ ุงุฎุชุจุงุฑ:

1. **ุชุตุฏูุฑ PDF ูููุดุงุฑูุน:**
   - ุงูุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ
   - ุงุฎุชุฑ "ุชุตุฏูุฑ" โ "PDF" โ
   - ุชุฃูุฏ ูู ูุชุญ ูุงูุฐุฉ ุฌุฏูุฏุฉ ูุน ุชูุฑูุฑ ุนุฑุจู ุตุญูุญ โ
   - ุงุฎุชุฑ "ุญูุธ ูู PDF" ูู ูุฑุจุน ุงูุทุจุงุนุฉ โ

2. **ููุญุฉ ุงูุชุญูููุงุช - ุงููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ:**
   - ุงูุชุญ ููุญุฉ ุงูุชุญูููุงุช โ
   - ุชุญูู ูู ุจุทุงูุฉ "ูุดุงุฑูุน ูุชุฃุฎุฑุฉ" โ
   - ุงูุนุฏุฏ ูุฌุจ ุฃู ูููู ุตุญูุญ ุจูุงุกู ุนูู:
     - ุงููุดุงุฑูุน ุจุญุงูุฉ "ูุชุฃุฎุฑ" ุฃู "ูุชุนุซุฑ" โ
     - ุงููุดุงุฑูุน ุงูุชู ุงูุชูู ููุนุฏูุง ููู ุชูุชูู โ

3. **ุฑูุน ุงูุตูุฑ ูู ุงูุชูุงุฑูุฑ ุงูููููุฉ:**
   - ุงูุชุญ "ุงูุชูุงุฑูุฑ ุงูููููุฉ" โ
   - ุงุถุบุท "ุฅูุดุงุก ุชูุฑูุฑ ูููู" โ
   - ุงุฎุชุฑ ุตูุฑ ูุชุนุฏุฏุฉ ูู ุฌูุงุฒู โ
   - ุชุฃูุฏ ูู ุธููุฑ ุงูุตูุฑ ุฃุณูู ุญูู ุงูุฑูุน โ
   - ุงุญูุธ ุงูุชูุฑูุฑ โ
   - ุงูุชุญ ุงูุชูุฑูุฑ ููุชุนุฏูู ูุฑุฉ ุฃุฎุฑู โ
   - ุชุฃูุฏ ูู ุธููุฑ ุงูุตูุฑ โ

4. **ุนุฑุถ ุงูุตูุฑ ูู ุงูุชูุฑูุฑ ุงูููุตุฏูุฑ:**
   - ุงูุชุญ ุชูุฑูุฑ ูููู ูุญุชูู ุนูู ุตูุฑ โ
   - ุตุฏูุฑ ุงูุชูุฑูุฑ ุจุตูุบุฉ PDF/Word/Excel โ
   - ุชุฃูุฏ ูู ุธููุฑ ุงูุตูุฑ ูู ุงูููู ุงูููุตุฏูุฑ โ

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### ๐ฅ ุจุงููุณุจุฉ ููุตูุฑ:
- ุงูุตูุฑ ุชูุญูุธ ูู **base64 strings** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุนููุฏ `images: text[]`)
- ุงูุญุฏ ุงูุฃูุตู ูุญุฌู ูู ุตูุฑุฉ: **2MB**
- ูููู ุฑูุน **ุนุฏุฉ ุตูุฑ** ูู ููุณ ุงูุชูุฑูุฑ
- ุงูุตูุฑ ุชูุนุฑุถ ูุจุงุดุฑุฉ ุนูุฏ ุงูุฑูุน
- ูููู ุญุฐู ุฃู ุตูุฑุฉ ูุจู ุงูุญูุธ
- ุงูุตูุฑ ุชุธูุฑ ูู ุงูุชูุฑูุฑ ุงูููุตุฏูุฑ (PDF/Word/Excel)

### ๐ฅ ุจุงููุณุจุฉ ููุชุตุฏูุฑ:
- ุชุตุฏูุฑ PDF ูููุดุงุฑูุน ููุชุญ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ
- ูุฑุจุน ุงูุทุจุงุนุฉ ูุธูุฑ ุชููุงุฆูุงู
- ูููู ุงุฎุชูุงุฑ "ุญูุธ ูู PDF" ูู ูุฑุจุน ุงูุทุจุงุนุฉ
- ุงููุต ุงูุนุฑุจู ูุธูุฑ ุจุดูู ุตุญูุญ **ุจุฏูู ุฃู ุฑููุฒ ุบุฑูุจุฉ**

### ๐ฅ ุจุงููุณุจุฉ ูููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ:
- ูุชู ุญุณุงุจ ุงููุดุงุฑูุน ุจูุงุกู ุนูู:
  1. ุงูุญุงูุฉ (ูุชุฃุฎุฑุ ูุชุนุซุฑ)
  2. ุชุงุฑูุฎ ุงูููุงูุฉ (ุฅุฐุง ูุถู ููู ููุชูู ุงููุดุฑูุน)
- ุงูููุงุฑูุฉ ุชุชู ุจุฏูู ููุช (ููุท ุงูุชุงุฑูุฎ)
- ุงูุนุฏุฏ ุฏููู ูุตุญูุญ 100%

---

## ๐ **ุฎูุงุตุฉ:**

**ุชู ุฅููุงู ุฌููุน ุงูุฅุตูุงุญุงุช ุงููุทููุจุฉ ุจูุฌุงุญ!** ๐๐ธ๐ฆ

- โ ูุดููุฉ ุงูุฑููุฒ ุงูุบุฑูุจุฉ ูู PDF **ุชู ุญููุง**
- โ ุญุณุงุจ ุงููุดุงุฑูุน ุงููุชุฃุฎุฑุฉ **ุตุญูุญ ูุฏููู**
- โ ุฑูุน ูุนุฑุถ ุงูุตูุฑ **ูููุนูู ุจุงููุงูู**
- โ ุงููุธุงู ูุณุชุฎุฏู **ุจูุงูุงุช ุญููููุฉ ูู Supabase ููุท**
- โ ูุง ุชูุฌุฏ ุจูุงูุงุช ููููุฉ ุฃู KV Store
- โ ุงูุนููุฉ: **ุงูุฑูุงู ุงูุณุนูุฏู**

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจูุงูู ุทุงูุชู!** ๐ชโจ
